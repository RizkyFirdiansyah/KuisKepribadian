<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard</title>
  <link rel="stylesheet" href="assets/css/style.css" />
</head>

<body>
  <div class="container">
    <nav>
      <div class="navbar">
        <img src="assets/img/hamburger.svg" alt="" onclick="openSidebar()" id="openNav" />
        <div class="social-icon">
          <a href=""><img src="assets/img/ig.svg" alt="" /></a>
          <a href=""> <img src="assets/img/yt.svg" alt="" /></a>
          <a href=""> <img src="assets/img/twitter.svg" alt="" /></a>
        </div>
      </div>
      <div class="nav-menu" id="mySidebar">
        <div>
          <img src="assets/img/close.svg" alt="" onclick="closeSidebar()" />
          <a href="index.html">
            <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 32 32">
              <path fill="currentColor"
                d="M16.612 2.214a1.01 1.01 0 0 0-1.242 0L1 13.419l1.243 1.572L4 13.621V26a2.004 2.004 0 0 0 2 2h20a2.004 2.004 0 0 0 2-2V13.63L29.757 15L31 13.428ZM18 26h-4v-8h4Zm2 0v-8a2.002 2.002 0 0 0-2-2h-4a2.002 2.002 0 0 0-2 2v8H6V12.062l10-7.79l10 7.8V26Z" />
            </svg>
            Beranda</a>
          <a href="formKuis.html">
            <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 512 512">
              <path fill="currentColor"
                d="M512 124.7L256 18L0 124.7l256 106.7zM256 274l-144.9-67.6L0 252.7l256 106.7l256-106.7l-111.1-46.3zm0 128l-139.6-69.8L0 380.7l256 106.7l256-106.7l-116.4-48.5z" />
            </svg>
            Kuis</a>
          <a href="dbAdmin.html">
            <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 20 20">
              <path fill="currentColor"
                d="M10 0c5.523 0 10 4.477 10 10s-4.477 10-10 10S0 15.523 0 10S4.477 0 10 0m.667 1.359v1.035a.667.667 0 0 1-1.334 0V1.359A8.614 8.614 0 0 0 5.637 2.51l.522.584a.667.667 0 0 1-.995.888l-.63-.707a8.714 8.714 0 0 0-1.776 1.962l.843.506a.667.667 0 0 1-.686 1.143l-.803-.481a8.607 8.607 0 0 0-.709 2.491h.907a.667.667 0 1 1 0 1.334l-.973-.001v.031a8.627 8.627 0 0 0 .742 3.263l.836-.559a.667.667 0 0 1 .741 1.109l-.939.627A8.66 8.66 0 0 0 10 18.667a8.662 8.662 0 0 0 7.447-4.23l-1.132-.757a.667.667 0 0 1 .74-1.109l.989.661a8.633 8.633 0 0 0 .62-3.003H17.58a.667.667 0 0 1 0-1.333h1.017a8.608 8.608 0 0 0-.57-2.168l-.95.492a.667.667 0 1 1-.612-1.184l.965-.5a8.71 8.71 0 0 0-1.839-2.158l-.602.789a.667.667 0 1 1-1.06-.81l.58-.76a8.615 8.615 0 0 0-3.842-1.238m3.248 5.46a.667.667 0 0 1-.104.937l-2.04 1.631l.007.12c0 .692-.529 1.262-1.205 1.326l-.129.006a1.333 1.333 0 1 1 .558-2.544l1.976-1.58a.667.667 0 0 1 .937.104" />
            </svg>
            Dashboard</a>
        </div>
      </div>
    </nav>
    <div id="main">
      <div class="content">
        <div class="form-login" id="loginForm">
          <h2>Login Admin</h2>
          <form action="" onsubmit="return handleLogin()">
            <label for="username">Username</label>
            <input type="text" name="username" id="username" placeholder="Username" />
            <label for="password">Password</label>
            <input type="password" name="password" id="password" placeholder="Password" />
            <button type="submit">Login</button>
          </form>
        </div>
        <div id="statistics">
          <h2>statistik</h2>
          <table id="hasilPendaftaran">
            <tr>
              <th>Jumlah Kepribadian Introvert</th>
              <td id="introvert-count">Loading...</td>
            </tr>
            <tr>
              <th>Jumlah Kepribadian Extrovert</th>
              <td id="extrovert-count">Loading...</td>
            </tr>
            <tr>
              <th>Jumlah Kepribadian Ambivert</th>
              <td id="ambivert-count">Loading...</td>
            </tr>
            <tr>
              <th>Jumlah Total yang Melakukan Tes</th>
              <td id="total-users">Loading...</td>
            </tr>
          </table>
          <button id="download-txt">Download Data</button>
        </div>
      </div>
    </div>

    <script>
      const handleLogin = () => {
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');

        const username = usernameInput.value.trim();
        const password = passwordInput.value.trim();

        if (username === '' || password === '') {
          alert('Username dan Password tidak boleh kosong!');
          return false;
        }

        // Contoh: Jika username dan password sesuai, tampilkan statistik
        if (username === 'admin' && password === '123') {
          document.getElementById('loginForm').style.display = 'none';
          document.getElementById('statistics').style.display = 'block';
          return false;
        } else {
          alert('Login Gagal!');
          return false;
        }
      };

      // Fetch the stats when the page loads
      document.addEventListener('DOMContentLoaded', () => {
        fetch('/get-stats')
          .then(response => response.json())
          .then(data => {
            // Update the HTML with the fetched data
            document.getElementById('total-users').textContent = data.totalUsers;
            document.getElementById('introvert-count').textContent = data.personalityData.Introvert;
            document.getElementById('extrovert-count').textContent = data.personalityData.Extrovert;
            document.getElementById('ambivert-count').textContent = data.personalityData.Ambivert;

            // Add a download button for CSV
            const downloadTXTButton = document.getElementById('download-txt');
            downloadTXTButton.addEventListener('click', () => {
              downloadTXT(data.personalityData, data.totalUsers);
            });
          })
          .catch(error => console.error('Error fetching stats:', error));
      });

      function downloadTXT(personalityData, totalUsers) {
        let txtContent = '';

        // Data
        for (const [personality, count] of Object.entries(personalityData)) {
          txtContent += `Jumlah Kepribadian ${personality}: ${count}\n`;
        }

        // Total Users
        txtContent += `Jumlah Total Yang Melakukan Tes: ${totalUsers}`;

        // Buat file Blob dan tautkan ke elemen anchor untuk di-download
        const blob = new Blob([txtContent], { type: 'text/plain' });
        const link = document.createElement('a');

        link.href = URL.createObjectURL(blob);
        link.download = 'data_kuis.txt';

        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      }
    </script>

    <script src="assets/js/script.js"></script>
</body>

</html>